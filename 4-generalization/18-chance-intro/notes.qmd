---
title: "Introducing the Box Model"
subtitle: "We will introduce the ideas of chance, or probability, via a mechanism called a box model. "
date: '`r format(Sys.Date(), "%B %d, %Y")`'
format:
  html:
    toc-depth: 4
    code-fold: true
    code-link: true
    code-summary: "."
execute: 
  warning: false
  message: false
---

[[Discuss]{.btn .btn-primary}](https://app.perusall.com) [[Reading Questions]{.btn .btn-primary}](https://www.gradescope.com/courses/416233)
[[PDF]{.btn .btn-primary}](notes.pdf)

\

```{r}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(stat20data)
library(infer)
library(palmerpenguins)
```

[I]{.dropcap}n the last set of notes, we revisited the data cycle, and saw that, in order to use the obtained data to answer a question about our
*target population*, we have to make sure that our data is
representative of the population. Most people have  some
understanding of what it means for a sample to be representative. In
the picture below, which sample would you say better represents the
population in the box?

![](images/two-samples.jpeg){fig-align=center width="400"}

The mechanisms and methods we use for obtaining
data are crucial in determining whether the data will be
useful in answering our question about the target population. They are
the *protocols* for our experimental design, or measurements,
or survey design and sampling. For example, if the data are from a
clinical trial for a new Covid-19 treatment, the design of the trial
will decide who gets the treatment, and who doesn't. Or perhaps we
want to poll voters to see if there is support for decriminalizing
marijuana possession federally (President Biden took a first step
towards this goal by pardoning all Americans  convicted of simple
marijuana possession under federal law). Who is selected for such an 
opinion poll can make a big difference in the estimate of the proportion of voters that support decriminalization of marijuana. You may have observed that some polling companies are more successful than others in their estimates and predictions, and consequently they are taken more seriously. Below is a snapshot of rankings of polling organizations from the well-known website FiveThirtyEight[^538]. According to the website, the rankings are based on the polling organization's ``historical accuracy and methodology''

[^538]: This website was begun as poll aggregation site, by the statistician Nate Silver.]

![](images/538-pollster-ranking-snippet.png){fig-align=center width="500"}

You learned about the variation in data that is induced by using *chance* to select the data - the variation could be caused by the sampling method, or the way units are assigned to groups, or from measurement error. In order to understand variation, we have to understand the chance mechanism which was used to collect the data. 
In these notes, we are going to describe methods by which we can
obtain representative samples from the target population - or rather,
from our access frame. In practice, it is rare for the access frame
and target population to exactly coincide. We need to design our
data collection methods (our protocols) so that our target
population and our access frame overlap as much as we can manage. This
is achieved using methods that incorporate chance.

## Introducing the Box Model

One of the simplest ways of understanding chance, and later variation, is by considering a
*box model*[^fppbox]. A box model consists of a box of tickets, from which tickets are drawn.
To specify a box model, we have to say what tickets go in the box (that is, what are the values on the tickets, and how many of each value) , and
whether they will be drawn *with* or without replacement (after drawing a ticket from the box, do we put it back in the box or not, before we draw another ticket).

![](images/box-1.jpeg){fig-align=center width="400"}

Consider the box above. The chance of drawing a ticket labeled "4" is one
in five, as there are five tickets to choose from and only one is
labeled "4". The chance of drawing a ticket marked "2" is two in five,
since there are two tickets labeled "2" out of the five tickets in
the box.

Let's practice creating boxes to model common scenarios. For each of the cases below, specify:

1. The box and tickets (what tickets go in the box, and their values)
2. The number of draws
3. Whether or not we replace tickets between draws

We assume that the tickets in the box are *equally likely* to be drawn[^uar].

#### Example 1: Tossing a fair coin once 
What box and which tickets would you use to simulate one coin toss?

<details><summary>Check your answer</summary>
We could draw one ticket from the box 
![](images/coin_ht.jpeg){fig-align=center width="100"}

Or we could draw one ticket from the box
![](images/coin.jpeg){width="100"}
with the ticket $\fbox{1}$ representing the coin landing heads, and $\fbox{0}$ representing the coin landing tails.
Can you think of advantages of using the second box?
</details>

:::{.callout-warning icon=false}

## Ask yourself
What box would we use if the coin is not a fair coin, but lands heads $5$ out of $6$   times?

:::

#### Example 2: Tossing a coin twice and counting the number of heads

If we toss a coin twice, we could list the possible *outcomes* as two heads, two tails, or one head and one tail. So you might think of the following box, from which we would draw once:
![](images/bad-box.jpeg){width="200"}.

This box describes all the possible things that can happen when you toss a coin twice, but it doesn't fit the specifications of a box model that we listed above. What's the problem?

<details><summary>Check your answer</summary>
If you thought to yourself: this doesn't satisfy the second requirement - of all the tickets being equally likely, that's right! The third ticket in that box is twice as likely as the other two, since you can the get the outcome of  one head and one tail in two ways: the first toss landing heads and the second one tails, or the other way around. 
A better box would be the one below. The tickets are equally likely, and we would draw once (and then count the number of "H"'s on the ticket). 

![](images/better-box.jpeg){width="200"}

The best box would be the one we introduced in the first example:

![](images/coin.jpeg){width="100"}
Remember that the ticket $\fbox{1}$ represents the outcome of a toss landing heads and  $\fbox{0}$ represents a toss landing tails (because we are counting the number of heads. If we were counting the number of tails, we would have  $\fbox{1}$ representing the outcome of a toss landing tails. We let the box be as above, and draw two tickets *with replacement* from this box. To count the number of heads in two tosses, we add the drawn tickets.
</details>

#### Example 3: Rolling a fair die
<details><summary>Check your answer</summary>
The box will have six tickets as shown below, and we would draw one ticket from this box. The chance of any one of the tickets i $1/6$.

![](images/die.jpeg){width="200"}
</details>



#### Example 4: Rolling a pair of fair dice and summing the spots

<details><summary>Check your answer</summary>
We would the same box, with six tickets as shown below, and we would draw *twice* with replacement from this box, then add the draws.

![](images/two-dice.jpeg){width="450"}

</details>



#### Example 5: Spinning a roulette wheel

![](images/roulette-us.jpg){fig-align="center" width="200"}[^roulette_image]

An American roulette wheel has 38 pockets, of which 18 are red, 18 black, and 2 are green. The wheel is spun, and a small ball is spun in the opposite direction. Players bet on which pocket which players bet on which colored or numbered pocket the ball will come to rest in. How would you represent the box if you wanted to bet on a number? What about if you wanted to bet on the ball landing in a red pocket? 

<details><summary>Check your answer</summary>
We would use the boxes shown below. In the top box, there are 38 tickets, each representing a numbered pocket on the wheel. Draw one ticket to represent the ball landing in a particular pocket. In the second row each ticket represents a colored pocket, and we see that there are 18 red pockets, 18 black, and 2 green. If we are only interested in the outcome *ball lands in red pocket*, then the box with 18 tickets marked 1 and 20 marked 0 will work. We would draw once from it, with the ticket marked $\fbox{1}$ representing the ball landing in a red pocket, and the ticket $\fbox{0}$ representing the ball *not* landing in a red pocket, but in a green or black pocket. We can see that the chance of drawing a  $\fbox{1}$ isv 2 out of 38 or $1/19$.

![](images/roulette-bet.jpeg){fig-align="center" width="300"}

</details>

The scenario where we bet on red, and so the box tickets can be re-labeled as 0 or 1, is called *classifying and counting*. In this we draw tickets from the box, where there may be many outcomes, but we only label a ticket with 1 if we want to count that outcome. Otherwise, we label the ticket with 0.


#### Example 6: Selecting 2 people out of a group of 5 
##### (drawing *without* replacement)
We have a group of 5 people: Alex, Emi, Fred, Max, and Nan. Two of the five are to be selected at random to form a two person committee.Draw the box model for this situation.
<details><summary>Check your answer</summary>

![](images/committee.jpeg){fig-align=center width="600"}

All the ten pairs are equally likely. On the first draw, there are 5 tickets to choose from, and on the second there are 4, making $5 \times 4 = 20$ possible draws of two tickets, drawn from this box, one at a time, without replacement. We have only 10 pairs here because of those 20 pairs, there are only 10 distinct ones. When we count 20 pairs, we are counting Alex $+$ Emi as one pair, and Emi $+$ Alex as another pair.  
</details> 

What is the chance that Alex and Emi will be selected? Guess! (Hint: you have seen all the possible pairs above, and they are equally likely. What will be the chance of any one of them?) What is the chance that Alex will be selected for the sample? 

#### Example 7: Selecting 5 penguins from the penguins dataset.
![](images/penguins.png){fig-align=center width="300"}

You have seen the penguins data, which measured `r ncol(penguins)` variables on a sample of `r nrow(penguins)`. Here the box will contain 344 tickets, and we will draw 5 tickets *without* replacement. Note that each ticket in the box represents one penguin in the sample has information for multiple variables measured on that penguin, and we would consider only the information we are interested in.

![](images/penguin-ticket.jpeg){fig-align=center width="150"}

#### Example 8: Survey sampling

![](images/pew-jewish.png){fig-align=center width="300"}

From November 2019 to June 2020, the Pew Research Center conducted a survey of Jewish Americans to understand what it means to "Jewish in America"[^pew1]. Here is how they began the selection of their survey respondents: "Although the survey focuses on Jewish adults, we began by taking a large sample of the general public. We randomly selected residential addresses from a U.S. Postal Service computerized list and mailed letters to people across the country, asking them to take a short survey."[^pew2]. 

How would you describe the box model for this stage of the survey? That is, what is the *access frame* for this stage of the survey?
<details><summary>Check your answer</summary>
The box would contain as many tickets as there are residential addresses in the USPS list. Each ticket has a name and address on it, and tickets are drawn without replacement, as many as are needed for the sample.

[^pew1]: <https://www.pewresearch.org/religion/2021/05/11/jewish-americans-in-2020/>
[^pew2]: <https://www.pewresearch.org/religion/2021/05/11/jewish-americans-in-2020-answers-to-frequently-asked-questions/>

#### Example 9: Tossing an unfair coin

How would you use a box model to describe the chances in the scenario that was specified after Example 1, with an unfair coin which has a chance $5/6$ of landing heads when tossed. Specify the box and the tickets.

<details><summary>Check your answer</summary>

You can draw the box in two ways, but the second is more useful, in case we want to toss the coin more than once and count the number of heads.
![](images/unfair-coin.jpeg){fig-align=center width="500"}
The chance of coin landing heads is the same as the chance of drawing eithe $\fbox{H}$ from the first box or $\fbox{1}$ from the second. In both cases, the chance is $5/6$, since the tickets are equally likely to be drawn.
</details>

## The `sample()` function in R

:::{.callout-tip}

## Code along

As you read through these notes, keep RStudio open in another window to code along at the console.
:::

The box model is easily simulated in R, since there is a convenient function that does exactly what we need: draw tickets from a "box" (a vector). We will use the function `sample(x, size = n, replace = FALSE)`, where `x` is the vector you want to sample from, `size` is the number of draws (with the default value being the length of `x`), and `replace` specifies whether the draws are with or without replacement. The default in `sample()` is to draw them without replacement. 


```{r}
#| code-fold: false
set.seed(12345)
box <- c(1, 2, 2, 3, 4)
sample(box,1)
```

We can use `sample()` to *estimate* the chance of a particular outcome  when we aren't sure of what that chance might be. We would do this by repeatedly sampling from the "box" with replacement (many times), then computing the proportion of times we drew each ticket. For example, say we consider the box from above, and want to estimate the chance of each ticket.

In the code below, another new function is introduced: `replicate()`. The function `replicate(reps, expr)` is a very useful function that takes as input an expression `expr` and evaluates it `reps` times, returning a vector. 

```{r}
#| code-fold: false
#| fig-width: 4
#| fig-height: 3
#| fig-align: center

box <- c(1, 2, 2, 3, 4)
draws <- replicate(2000, sample(box, 1, replace = TRUE))
ggplot(as.data.frame(draws), aes(x=draws)) + 
  geom_bar(aes(y=..prop..), fill="gray50")+ 
  ylab("proportion of draws") + 
  xlab("ticket drawn")
```
We see that the chance of drawing a $\fbox{2}$ is about 0.4, twice the chance of drawing any other ticket, which makes sense as there were two tickets marked 2. Of course, we could have written down the chance of drawing a 2 without needing to code it in R. But let's think of a more complicated situation: 

What if we wanted to wanted to draw _five_ tickets with replacement from this box, and sum the draws? What would be the possible values that we would get? What could their chances be? We can visualize this in R:

```{r}
#| code-fold: false
#| fig-width: 4
#| fig-height: 3
#| fig-align: center

box <- c(1, 2, 2, 3, 4)
draws <- replicate(5000, sum(sample(box, size = 5, replace = TRUE)))
ggplot(as.data.frame(draws), aes(x=draws)) + 
  geom_bar(aes(y=..prop..), fill="gray50")+ 
  ylab("proportion") + 
  xlab("sum of draws") + 
  scale_x_continuous(breaks = seq(min(draws), max(draws), by = 1))
```

We can see that there is a lot more variation in the values taken by the sum of 5 draws.

#### Tossing a fair coin

We can estimate the chances of various outcomes related to coin tossing, using the box. 

Suppose, for example, that we would like to figure out the chance of exactly 2 heads if we toss a coin 4 times. Think about how you would use the functions `sample()` and `replicate()` to model this, using the 0-1 box we defined earlier, for tossing a coin.

```{r}

coin <- c(0, 1) #1 represents the toss landing heads
two_heads <-replicate(50000, sum(sample(coin, 4, replace = TRUE)) == 2)
cat("The proportion of times we see 2 heads out of 4 tosses is", mean(two_heads))

```


#### Rolling a pair of dice and summing the spots

This is something that we could use if we wanted to play Monopoly and couldn't find the dice. Recall the box we used to simulate a die roll. Now we are going to define a vector in R to represent a die, and sample twice with replacement, from this vector.


```{r}
die <- 1:6
# to simulate rolling a die twice and summing the spots
draws <- sample(die, size = 2, replace = TRUE)
sum(draws)

```

We could also repeat it many times and estimate the chance of each of the possible outcomes.

```{r}
#| fig-width: 4
#| fig-height: 3
#| fig-align: center

many_draws <- replicate(5000, sum(sample(die, size = 2, replace = TRUE)))
ggplot(as.data.frame(many_draws), aes(x=many_draws)) + 
  geom_bar(aes(y=..prop..), fill="gray50")+ 
  ylab("proportion") + 
  xlab("sum of two draws") + 
  scale_x_continuous(breaks = seq(min(many_draws), 
                                  max(many_draws), by = 1))

```


:::{.callout-warning icon=false}

## Ask yourself

We know all the possible outcomes of summing a pair of dice (between $2$ and $12$ spots). Why not make a box with tickets labeled $2, 3, 4, \ldots, 12$ and draw *once* from that box? If we did indeed want a box from which we would only draw once, what would the box be? (Hint: How many possible outcomes would there be if you rolled a pair of dice. )
:::

#### Sampling from penguins


## Rules of chance

What we have done here is estimate chances using the idea that the *chance* (or probability) of something is the proportion of times it occurs when we simulate over and over again the basic process that results in the thing we are counting. We have used the definition of the chance of an outcome to be the proportion of times we expect it to occur when the process that generates the event is  *independently* repeated many times [^freq].

The chance of an event (where an *event* might be one outcome, such as "rolling a die and seeing 2", or a collection of outcomes, such as "rolling an even number") needs to satisfy some basic mathematical rules (which are intuitively clear if you think of the chance of an event as its relative frequency):

1. The chance of any event is at least 0 and not more than 1.

2. We call the collection of all possible outcomes the *sample space*. The chance of the sample space is 1. 

3. If two events do not overlap, that is they have no outcomes in common, then the chance that *either* of the two events might occur is the *sum* of their chances.
For example, consider rolling a fair six-sided die, and the two events of rolling a multiple of 5 or a multiple of 2. In the first event (which we can call $A$), the possible outcomes are $\{5\}$. For the second event (call it $B$), the possible outcomes are $\{2, 4, 6\}$. Since all the sides of a fair die are equally likely, the chance of $A$ is the chance of rolling a $5$ which is $1/6$. The chance of rolling an even number is $1/6 + 1/6 +1/6 = 3/6$ (applying the same idea of adding up the chances, since we can't have the die show two sides at the same time). 
This implies that the chance of *either* $A$ *or* $B$ happening is $1/6 + 3/6 = 4/6$.

Note that *both* events cannot happen - using a six-sided die, you cannot roll a multiple of 5 that is also an even number. We say then that the event that both $A$ and $B$ happen is impossible, and impossible events have no chance of occurring. That is the chance of $A$ *and* $B$ is 0.

## With or without replacement?

When we draw with replacement, we draw one ticket, and put it back before drawing another ticket. In terms of the first box we looked at, if we draw twice, both times we will draw from the following box:

![](images/box.jpeg){fig-align=center width="200"}

If we draw twice without replacement, then our second draw is from a *different* box, illustrated below:

![](images/no-replace-box.jpeg){fig-align=center width="300"}

### Conditional probability

In the second box above, notice that the chance of drawing a $\fbox{2}$ changed after the first draw. At first, the chance that a $\fbox{2}$ would be drawn is 2 in 5 or 0.4, but the chance increases in the second box to 0.5, which is called a *conditional chance*, since it depends on what happens in the first draw.

#### more
<more about conditional prob and box with  tickets with two parts.

 [^freq]: This is known as the *frequentist* theory of probability: the chance of something is the relative frequency with which it occurs in repeated trials (that are assumed to be independent).

[^fppbox]: The box model was introduced by Freedman, Pisani, and
Purves in their textbook
[*Statistics*](https://wwnorton.com/books/9780393929720)
[^uar]: We call the tickets equally likely when each ticket has the same chance of being drawn. That is, if there are $n$ tickets in the box, each has a chance of $1/n$ to be drawn. We also refer to this as drawing a ticket *uniformly at random*, because the chance of drawing the tickets are the same, or *uniform*.
[^roulette_image]: Photo by Derek Lynn via unsplash.com